<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶ä¸‹è½½è·³è½¬</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; text-align: center; background: #fff; min-height: 100vh; box-sizing: border-box; }
        .icon { font-size: 64px; margin-bottom: 20px; display: block; }
        .file-name { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 10px; word-break: break-all; }
        .tip { color: #666; font-size: 14px; margin-bottom: 30px; }
        .btn { display: inline-block; padding: 12px 30px; background-color: #007bff; color: #fff; text-decoration: none; border-radius: 25px; font-size: 16px; transition: background 0.3s; }
        .btn:hover { background-color: #0056b3; }
        
        /* WeChat overlay */
        #wechat-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; }
        .arrow { position: absolute; top: 10px; right: 20px; width: 50px; height: 50px; border-right: 2px solid #fff; border-bottom: 2px solid #fff; transform: rotate(45deg) skew(10deg, 10deg); }
        .arrow::before { content: ''; position: absolute; top: 28px; left: 10px; width: 40px; height: 2px; background: #fff; transform: rotate(-45deg); }
        .text-tip { position: absolute; top: 80px; right: 20px; color: #fff; font-size: 18px; line-height: 1.5; text-align: right; }
        .text-tip span { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>

    <div id="wechat-overlay">
        <div class="text-tip">
            <p>è¯·ç‚¹å‡»å³ä¸Šè§’ <span>...</span></p>
            <p>é€‰æ‹© <span>åœ¨æµè§ˆå™¨æ‰“å¼€</span> ä»¥ä¸‹è½½æ–‡ä»¶</p>
        </div>
    </div>

    <div class="container">
        <div style="padding-top: 60px;">
            <span class="icon">ğŸ“„</span>
            <div class="file-name" id="file-name">æ­£åœ¨è·å–æ–‡ä»¶ä¿¡æ¯...</div>
            <p class="tip" id="status-tip">æ­£åœ¨å°è¯•è‡ªåŠ¨ä¸‹è½½...</p>
            <a id="download-btn" href="#" class="btn">ç‚¹å‡»ä¸‹è½½</a>
        </div>
    </div>

    <script>
        (function() {
            function getQueryParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return decodeURIComponent(r[2]); return null;
            }

            var url = getQueryParam('url');
            var name = getQueryParam('name');
            
            var fileNameElem = document.getElementById('file-name');
            var statusTip = document.getElementById('status-tip');
            var downloadBtn = document.getElementById('download-btn');
            var overlay = document.getElementById('wechat-overlay');

            if (!url) {
                fileNameElem.innerText = 'æ— æ•ˆçš„é“¾æ¥';
                statusTip.innerText = 'ç¼ºå°‘ä¸‹è½½åœ°å€å‚æ•°';
                downloadBtn.style.display = 'none';
                return;
            }

            if (name) {
                fileNameElem.innerText = name;
                document.title = 'ä¸‹è½½: ' + name;
            } else {
                fileNameElem.innerText = 'æ–‡ä»¶ä¸‹è½½';
            }

            downloadBtn.href = url;

            // Detect WeChat
            var ua = navigator.userAgent.toLowerCase();
            var isWeChat = ua.indexOf('micromessenger') !== -1;

            if (isWeChat) {
                overlay.style.display = 'block';
                statusTip.innerText = 'è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸‹è½½';
                // Optional: Prevent automatic click in WeChat to avoid errors
            } else {
                // Auto download attempt
                statusTip.innerText = 'æ­£åœ¨å‡†å¤‡ä¸‹è½½...';
                setTimeout(function() {
                    // Create a temporary link to simulate a click
                    // This is often more reliable than window.location.replace for downloads
                    var link = document.createElement('a');
                    link.href = url;
                    link.setAttribute('download', ''); // Hint to browser
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Update status
                    statusTip.innerText = 'å¦‚æœä¸‹è½½æ²¡æœ‰å¼€å§‹ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®';
                }, 1000);
            }
        })();
    </script>
</body>
</html>
